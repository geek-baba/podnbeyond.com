// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum LoyaltyTier {
  SILVER
  GOLD
  PLATINUM
}

enum RoomStatus {
  ACTIVE
  INACTIVE
  MAINTENANCE
}

enum ContentType {
  HERO_SECTION
  ABOUT_SECTION
  ROOMS_SECTION
  AMENITIES_SECTION
  TESTIMONIALS_SECTION
  CONTACT_SECTION
  FOOTER_SECTION
}

enum ImageType {
  HERO_BACKGROUND
  ROOM_IMAGE
  AMENITY_ICON
  TESTIMONIAL_AVATAR
  GALLERY_IMAGE
  LOGO
  FAVICON
}

// Updated Room model to match specifications
model Room {
  id            Int        @id @default(autoincrement())
  name          String
  type          String
  capacity      Int
  description   String?
  pricePerNight Float
  status        RoomStatus @default(ACTIVE)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  // Relationships
  bookings      Booking[]
  images        RoomImage[]
  ratePlans     RatePlan[]

  @@map("rooms")
}

// New RatePlan model
model RatePlan {
  id            Int      @id @default(autoincrement())
  roomId        Int
  seasonalPrice Float
  startDate     DateTime
  endDate       DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relationship to Room
  room          Room     @relation(fields: [roomId], references: [id])

  @@map("rate_plans")
}

model Booking {
  id          Int      @id @default(autoincrement())
  guestName   String
  email       String
  phone       String?
  checkIn     DateTime
  checkOut    DateTime
  guests      Int      @default(1)
  totalPrice  Float
  specialRequests String?
  status      BookingStatus @default(PENDING)
  
  // Relationship to Room
  roomId      Int
  room        Room     @relation(fields: [roomId], references: [id])
  
  // Relationship to Payments
  payments    Payment[]
  
  // Relationship to Loyalty Account
  loyaltyAccountId Int?
  loyaltyAccount   LoyaltyAccount? @relation(fields: [loyaltyAccountId], references: [id])
  
  // External booking fields
  externalBookingId String?     // External booking ID from channel
  externalChannel   String?     // Channel name (makemytrip, yatra, etc.)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("bookings")
}

model Payment {
  id          Int      @id @default(autoincrement())
  bookingId   Int
  booking     Booking  @relation(fields: [bookingId], references: [id])
  razorpayOrderId String?
  razorpayPaymentId String?
  amount      Float
  status      PaymentStatus @default(PENDING)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("payments")
}

// Updated LoyaltyAccount model to match specifications
model LoyaltyAccount {
  id          Int         @id @default(autoincrement())
  userId      String      @unique
  points      Int         @default(0)
  tier        LoyaltyTier @default(SILVER)
  lastUpdated DateTime    @default(now())
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relationship to Bookings
  bookings    Booking[]

  @@map("loyalty_accounts")
}

// New OTASyncLog model
model OTASyncLog {
  id        Int      @id @default(autoincrement())
  action    String
  details   String?
  timestamp DateTime @default(now())

  @@map("ota_sync_logs")
}

// CMS Models for Content Management

model Content {
  id          Int         @id @default(autoincrement())
  type        ContentType
  title       String?
  subtitle    String?
  description String?
  content     String?     // JSON content for complex sections
  isActive    Boolean     @default(true)
  sortOrder   Int         @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@map("contents")
}

model Image {
  id          Int       @id @default(autoincrement())
  type        ImageType
  filename    String
  originalName String
  path        String
  url         String
  altText     String?
  title       String?
  description String?
  isActive    Boolean   @default(true)
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relationship to Room Images
  roomImages  RoomImage[]
  
  // Relationship to Testimonials
  testimonials Testimonial[]
  
  // Relationship to Amenities
  amenities Amenity[]

  @@map("images")
}

model RoomImage {
  id        Int      @id @default(autoincrement())
  roomId    Int
  room      Room     @relation(fields: [roomId], references: [id])
  imageId   Int
  image     Image    @relation(fields: [imageId], references: [id])
  isPrimary Boolean  @default(false)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("room_images")
}

model Testimonial {
  id          Int      @id @default(autoincrement())
  guestName   String
  guestEmail  String?
  rating      Int      @default(5)
  title       String?
  content     String
  avatarImageId Int?
  avatarImage Image?   @relation(fields: [avatarImageId], references: [id])
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("testimonials")
}

model Amenity {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  iconName    String?
  iconImageId Int?
  iconImage   Image?   @relation(fields: [iconImageId], references: [id])
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("amenities")
}

model Setting {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  value       String
  description String?
  type        String   @default("text") // text, number, boolean, json, image
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("settings")
}
