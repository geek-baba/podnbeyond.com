# Cursor Rules for podnbeyond.com

## Project Overview
This is a hotel/property management system with:
- Backend: Node.js/Express with Prisma ORM
- Frontend: Next.js with TypeScript
- Features: Booking management, channel manager, loyalty system, RBAC, communications hub

## Coding Standards
- Use TypeScript for frontend code
- Follow existing code style and patterns
- Use Prisma for database operations
- Implement proper error handling and logging
- Follow the existing file structure

## Key Modules
- Channel Manager: `backend/modules/channelManager.js`
- RBAC: `backend/lib/rbac.js`
- Loyalty System: `backend/routes/loyalty.js`
- Cron Service: `backend/services/cronService.js`
- Template Engine: `backend/services/template-engine.js`
- Thread Linking: `backend/services/thread-linking.js`
- Conversations: `backend/routes/conversations.js`

## Important Notes
- Check `backend/env.example` for required environment variables
- Database migrations are in `backend/prisma/migrations/`
- Documentation is in the `docs/` directory
- Use PM2 for process management (see `ecosystem.config.js`)

## Agent Context Documents
When working on specific features, refer to these comprehensive context documents:

### Architecture Documentation (Authoritative - Current Implementation)
- **Booking System**: `docs/architecture/booking.md` - Complete booking lifecycle, state machine, API endpoints, and frontend components
- **Communication Hub**: `docs/architecture/communication-hub.md` - Unified conversation management across Email, WhatsApp, SMS, and Voice
- **RBAC System**: `docs/architecture/rbac.md` - Role-based access control, authentication, permissions, and invite system
- **Loyalty Program**: `docs/architecture/loyalty.md` - Multi-tier loyalty system, points calculation, tier progression, and booking integration

### Operations Documentation
- **Deployment**: `docs/operations/deployment.md` - Current deployment process for staging and production
- **Production Readiness**: `docs/operations/production-readiness.md` - Pre-launch checklist
- **Seed Data**: `docs/operations/seed-data.md` - Seed data scripts and usage guide
- **Environment Variables**: `docs/operations/environment-variables.md` - Complete environment variables reference

### Integration Documentation
- **Payment (Razorpay)**: `docs/integrations/payment-razorpay.md` - Payment integration (⚠️ partial implementation, security gaps noted)
- **Email (Postmark)**: `docs/integrations/email-postmark.md` - Transactional email system with BullMQ queue
- **WhatsApp/SMS (Gupshup)**: `docs/integrations/whatsapp-gupshup.md` - WhatsApp and SMS messaging integration

### Specifications (Historical Reference)
- **Booking Redesign**: `docs/specs/booking-redesign.md` - Historical redesign plan (led to current implementation in `docs/architecture/booking.md`)
- **Communication Hub v2**: `docs/specs/communication-hub-v2.md` - Historical redesign plan (led to current implementation in `docs/architecture/communication-hub.md`)
- **Loyalty Redesign**: `docs/specs/loyalty-redesign.md` - Historical redesign plan (led to current implementation in `docs/architecture/loyalty.md` - includes perks, campaigns, redemption catalog, points rules engine)

### Meta Documentation
- **Backlog**: `docs/meta/backlog.md` - Post-MVP enhancements and GitHub Actions CI/CD setup

## When Making Changes
- Update relevant documentation in `docs/architecture/`, `docs/operations/`, `docs/integrations/`, or `docs/meta/`
- Follow existing code style and patterns
- Test changes thoroughly before committing
- Consider database migrations for schema changes
- For Booking work: Check `docs/architecture/booking.md` for current implementation
- For Communication Hub work: Check `docs/architecture/communication-hub.md` for current implementation
- For RBAC work: Check `docs/architecture/rbac.md` for current implementation
- For Loyalty work: Check `docs/architecture/loyalty.md` for current implementation, `docs/specs/loyalty-redesign.md` for future plans

