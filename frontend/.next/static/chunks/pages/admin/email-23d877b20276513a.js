(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[239],{3454:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(7663)},9441:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/email",function(){return n(6738)}])},5732:function(e,t,n){"use strict";var r=n(5893);n(7294),t.Z=e=>{let{children:t,variant:n="neutral",size:a="md",className:s=""}=e;return(0,r.jsx)("span",{className:"inline-flex items-center font-medium rounded-full ".concat({capsule:"bg-capsule-100 text-capsule-800 border border-capsule-200",smart:"bg-smart-100 text-smart-800 border border-smart-200",sanctuary:"bg-sanctuary-100 text-sanctuary-800 border border-sanctuary-200",sauna:"bg-sauna-100 text-sauna-800 border border-sauna-200",neutral:"bg-neutral-100 text-neutral-800 border border-neutral-200",success:"bg-green-100 text-green-800 border border-green-200",warning:"bg-yellow-100 text-yellow-800 border border-yellow-200",error:"bg-red-100 text-red-800 border border-red-200"}[n]," ").concat({sm:"px-2 py-0.5 text-xs",md:"px-3 py-1 text-sm",lg:"px-4 py-1.5 text-base"}[a]," ").concat(s),children:t})}},4410:function(e,t,n){"use strict";var r=n(5893);n(7294),t.Z=e=>{let{variant:t="primary",size:n="md",fullWidth:a=!1,children:s,className:l="",disabled:i=!1,...c}=e;return(0,r.jsx)("button",{className:"".concat("font-semibold rounded-button transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"," ").concat({primary:"bg-neutral-900 text-white hover:bg-neutral-800 focus:ring-neutral-900",secondary:"border-2 border-neutral-900 text-neutral-900 hover:bg-neutral-900 hover:text-white focus:ring-neutral-900",capsule:"bg-capsule-500 text-white hover:bg-capsule-600 focus:ring-capsule-500",smart:"bg-smart-500 text-white hover:bg-smart-600 focus:ring-smart-500",sanctuary:"bg-sanctuary-500 text-white hover:bg-sanctuary-600 focus:ring-sanctuary-500",sauna:"bg-sauna-500 text-white hover:bg-sauna-600 focus:ring-sauna-500",ghost:"text-neutral-700 hover:bg-neutral-100 focus:ring-neutral-500"}[t]," ").concat({sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg",xl:"px-10 py-5 text-xl"}[n]," ").concat(a?"w-full":""," ").concat(l),disabled:i,...c,children:s})}},6738:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var r=n(5893),a=n(7294),s=n(5094),l=n(1163),i=n(9008),c=n.n(i),o=n(2734),d=n(8073),u=n(7360),x=n(6650),h=n(5732),m=n(4410),p=n(3454);function f(){let{data:e,status:t}=(0,s.a)(),n=(0,l.useRouter)(),[i,f]=(0,a.useState)([]),[b,g]=(0,a.useState)(null),[j,v]=(0,a.useState)([]),[y,N]=(0,a.useState)(!0),[w,E]=(0,a.useState)(!1),[T,B]=(0,a.useState)({subject:"",htmlBody:"",textBody:""});(0,a.useEffect)(()=>{if("loading"!==t){if("unauthenticated"===t)n.push("/admin/login");else if("authenticated"===t){var r,a,s;((null==e?void 0:null===(r=e.user)||void 0===r?void 0:r.roles)||[]).some(e=>["ADMIN","SUPERADMIN","MANAGER"].includes(e.key))||(null==e?void 0:null===(a=e.user)||void 0===a?void 0:a.email)==="admin@podnbeyond.com"||(null==e?void 0:null===(s=e.user)||void 0===s?void 0:s.email)==="shwet@thedesi.email"||n.push("/admin/forbidden")}}},[t,e,n]),(0,a.useEffect)(()=>{"authenticated"===t&&k()},[t]);let k=async()=>{try{N(!0);let e=await fetch("http://localhost:4000/api/email/threads"),t=await e.json();f(t.threads||[])}catch(e){console.error("Failed to load threads:",e)}finally{N(!1)}},Z=async e=>{try{let t=await fetch("http://localhost:4000/api/email/threads/".concat(e)),n=await t.json();g(n.thread),v(n.thread.emails||[]),n.thread.subject&&!n.thread.subject.startsWith("Re:")?B(e=>({...e,subject:"Re: ".concat(n.thread.subject)})):B(e=>({...e,subject:n.thread.subject}))}catch(e){console.error("Failed to load thread details:",e)}},C=async e=>{if(e.preventDefault(),b){E(!0);try{let e=await fetch("http://localhost:4000/api/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:b.participants.filter(e=>e!==(p.env.NEXT_PUBLIC_MAIL_FROM||"support@capsulepodhotel.com")),subject:T.subject,htmlBody:T.htmlBody||"<p>".concat(T.textBody,"</p>"),textBody:T.textBody,threadId:b.id,tag:"admin-reply"})}),t=await e.json();t.success?(await Z(b.id),B({subject:T.subject,htmlBody:"",textBody:""}),alert("Reply sent successfully!")):alert("Failed to send: ".concat(t.error))}catch(e){console.error("Reply error:",e),alert("Failed to send reply")}finally{E(!1)}}};return"loading"===t||y?(0,r.jsx)("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-neutral-900 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-neutral-600",children:"Loading Email Center..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-neutral-50",children:[(0,r.jsxs)(c(),{children:[(0,r.jsx)("title",{children:"Email Center | POD N BEYOND Admin"}),(0,r.jsx)("meta",{name:"description",content:"Email management for POD N BEYOND"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"}),(0,r.jsx)("link",{rel:"apple-touch-icon",href:"/logo-podnbeyond.png"})]}),(0,r.jsx)(o.Z,{}),(0,r.jsx)("section",{className:"pt-24 pb-8 bg-gradient-to-br from-neutral-900 to-neutral-800 text-white",children:(0,r.jsx)(u.Z,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold mb-2",children:"Email Center"}),(0,r.jsx)("p",{className:"text-neutral-300",children:"Manage guest communications"})]}),(0,r.jsx)(m.Z,{variant:"primary",onClick:k,children:"Refresh"})]})})}),(0,r.jsx)("section",{className:"py-8",children:(0,r.jsx)(u.Z,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)(x.Z,{variant:"default",padding:"lg",children:[(0,r.jsxs)("h2",{className:"text-xl font-bold text-neutral-900 mb-4",children:["Conversations (",i.length,")"]}),(0,r.jsx)("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:0===i.length?(0,r.jsxs)("div",{className:"text-center py-8 text-neutral-500",children:[(0,r.jsx)("p",{children:"No email conversations yet"}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"Inbound emails will appear here"})]}):i.map(e=>(0,r.jsxs)("div",{onClick:()=>Z(e.id),className:"p-4 rounded-lg cursor-pointer transition-all ".concat((null==b?void 0:b.id)===e.id?"bg-neutral-900 text-white":"bg-neutral-50 hover:bg-neutral-100"),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm line-clamp-1 ".concat((null==b?void 0:b.id)===e.id?"text-white":"text-neutral-900"),children:e.subject}),(0,r.jsx)(h.Z,{variant:"neutral",size:"sm",children:e._count.emails})]}),(0,r.jsxs)("p",{className:"text-xs mb-1 ".concat((null==b?void 0:b.id)===e.id?"text-neutral-300":"text-neutral-600"),children:[e.participants.slice(0,2).join(", "),e.participants.length>2&&" +".concat(e.participants.length-2)]}),(0,r.jsx)("p",{className:"text-xs ".concat((null==b?void 0:b.id)===e.id?"text-neutral-400":"text-neutral-500"),children:new Date(e.lastMessageAt).toLocaleString()})]},e.id))})]})}),(0,r.jsx)("div",{className:"lg:col-span-2",children:b?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)(x.Z,{variant:"default",padding:"lg",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-neutral-900 mb-2",children:b.subject}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:b.participants.map((e,t)=>(0,r.jsx)(h.Z,{variant:"neutral",children:e},t))})]}),(0,r.jsx)("div",{className:"space-y-4 max-h-[400px] overflow-y-auto",children:j.map(e=>(0,r.jsxs)(x.Z,{variant:"INBOUND"===e.direction?"bordered":"default",padding:"lg",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-bold text-neutral-900",children:e.fromName||e.fromEmail}),(0,r.jsx)("p",{className:"text-sm text-neutral-600",children:e.fromEmail})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)(h.Z,{variant:"INBOUND"===e.direction?"success":"neutral",children:e.direction}),(0,r.jsx)("p",{className:"text-xs text-neutral-500 mt-1",children:new Date(e.createdAt).toLocaleString()})]})]}),(0,r.jsx)("div",{className:"text-sm text-neutral-700 whitespace-pre-wrap",children:e.textBody||"No text content"}),e.attachments&&e.attachments.length>0&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-neutral-200",children:[(0,r.jsxs)("p",{className:"text-xs font-semibold text-neutral-700 mb-2",children:["Attachments (",e.attachments.length,")"]}),e.attachments.map(e=>(0,r.jsxs)("div",{className:"text-xs text-neutral-600 flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDCCE"}),(0,r.jsx)("span",{children:e.filename}),(0,r.jsxs)("span",{className:"text-neutral-400",children:["(",(e.size/1024).toFixed(1)," KB)"]})]},e.id))]}),e.events&&e.events.length>0&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-neutral-200",children:[(0,r.jsx)("p",{className:"text-xs font-semibold text-neutral-700 mb-2",children:"Events"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:e.events.map(e=>(0,r.jsx)(h.Z,{variant:"success",size:"sm",children:e.eventType},e.id))})]})]},e.id))}),(0,r.jsxs)(x.Z,{variant:"default",padding:"lg",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-neutral-900 mb-4",children:"Reply"}),(0,r.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-neutral-700 mb-2",children:"Subject"}),(0,r.jsx)("input",{type:"text",value:T.subject,onChange:e=>B({...T,subject:e.target.value}),required:!0,className:"w-full px-4 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-neutral-700 mb-2",children:"Message"}),(0,r.jsx)("textarea",{value:T.textBody,onChange:e=>B({...T,textBody:e.target.value}),required:!0,rows:8,className:"w-full px-4 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900",placeholder:"Type your reply..."})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)(m.Z,{type:"submit",variant:"primary",disabled:w,fullWidth:!0,children:w?"Sending...":"Send Reply"}),(0,r.jsx)(m.Z,{type:"button",variant:"secondary",onClick:()=>B({subject:T.subject,htmlBody:"",textBody:""}),children:"Clear"})]})]})]})]}):(0,r.jsx)(x.Z,{variant:"default",padding:"lg",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-neutral-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),(0,r.jsx)("p",{className:"text-neutral-600 font-semibold mb-2",children:"No conversation selected"}),(0,r.jsx)("p",{className:"text-sm text-neutral-500",children:"Select a conversation to view and reply"})]})})})]})})}),(0,r.jsx)(d.Z,{})]})}},7663:function(e){!function(){var t={229:function(e){var t,n,r,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:l}catch(e){n=l}}();var c=[],o=!1,d=-1;function u(){o&&r&&(o=!1,r.length?c=r.concat(c):d=-1,c.length&&x())}function x(){if(!o){var e=i(u);o=!0;for(var t=c.length;t;){for(r=c,c=[];++d<t;)r&&r[d].run();d=-1,t=c.length}r=null,o=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===l||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||o||i(x)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var s=n[e]={exports:{}},l=!0;try{t[e](s,s.exports,r),l=!1}finally{l&&delete n[e]}return s.exports}r.ab="//";var a=r(229);e.exports=a}()},1163:function(e,t,n){e.exports=n(3079)}},function(e){e.O(0,[996,177,888,774,179],function(){return e(e.s=9441)}),_N_E=e.O()}]);